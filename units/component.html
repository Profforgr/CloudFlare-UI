<!DOCTYPE html>
<html lang="en">
    <head>
        <title>CloudFlare UI Unit Tests</title>
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        
        <link rel="stylesheet" media="screen" href="/css/qunit.css" />
        <link rel="stylesheet" media="screen" href="/css/cloudflare.ui.core.css" />
        <link rel="stylesheet" media="screen" href="/css/cloudflare.ui.component.css" />
        
        
    </head>
    <body>
        
        <h1 id="qunit-header">CloudFlare UI Unit Tests</h1>
        <h2 id="qunit-banner"></h2>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        
        <div id="CompOne"></div>
        <div id="CompTwo"></div>
        
        <script type="text/javascript" src="/javascript/jquery/jquery-1.4.2.min.js"></script>
        <script type="text/javascript" src="/javascript/jquery/qunit.js"></script>
        <script type="text/javascript" src="/javascript/cloudflare/cloudflare.ui.core.js"></script>
        <script type="text/javascript" src="/javascript/cloudflare/cloudflare.ui.component.js"></script>
        <script type="text/javascript">
            
            $(function() {
                
                var BaseClass = $.cf.CloudFlareObject.subclass(
                    {
                        _construct: function() {
                            
                            this.inherit = true;
                        },
                        baseProperty: 'value',
                        baseOptions: {
                            
                            first: 1,
                            two: 'a'
                        },
                        baseMethod: function() {
                            
                            return true;
                        },
                        overwrittenMethod: function() {
                            
                            return 1;
                        },
                        hasInherit: function() {
                            
                            return this.inherit === true;
                        }
                    }
                );
                
                var SubClass = BaseClass.subclass(
                    {
                        _construct: function() {
                            
                            this.noInherit = true;
                            this.superMethod();
                        },
                        subProperty: true,
                        baseOptions: {
                            
                            two: 'b',
                            third: true
                        },
                        overwrittenMethod: function() {
                            
                            return 2;
                        }
                    }
                );
                
                var ThirdClass = SubClass.subclass(
                    {
                        _construct: function() {},
                        baseProperty: 99,
                        subProperty: false,
                        baseOptions: {
                            first: 2
                        },
                        overwrittenMethod: function() {
                            
                            return this.superMethod();
                        },
                        proxyBaseMethod: function() {
                            
                            return this.superClass.baseMethod();
                        },
                        proxyBaseOptions: function() {
                            
                            return this.superClass.baseOptions.first;
                        }
                    }
                );
                
                $.cf.component(
                    'cf.Foo',
                    {
                        initialize: function(options) {
                            
                            var self = this;
                            $.cf.log('Initializing foo. Element is ' + self._element);
                            self.setting = options.setting;
                        },
                        baseMethod: function() {
                            
                            return false;
                        },
                        assignClass: function() {
                            
                            var self = this;
                            self._element.addClass('fooClass');
                        },
                        hasSetting: function() {
                            
                            var self = this;
                            $.cf.log('Self is ' + self._componentName);
                            return self.setting == true;
                        },
                        setValue: function(valueOne, valueTwo) {
                            
                            var self = this;
                            self.value = valueOne + '.' + valueTwo;
                        },
                        getValue: function() {
                            var self = this;
                            return self.value;
                        },
                        getElement: function() {
                            
                            var self = this;
                            return self._element;
                        }
                    }
                );
                
                $.cf.component(
                    'cf.Bar',
                    $.cf.Foo,
                    {
                        initialize: function(options) {
                            
                            var self = this;
                            self.superMethod(options);
                        },
                        assignClass: function() {
                            
                            var self = this;
                            self._element.addClass('barClass');
                            self.superMethod();
                        }
                    }
                )
                
                test(
                    "Basic polymorphism",
                    function() {
                        
                        stop();
                        
                        try {
                            
                            var foo = new SubClass();
                            
                            if(foo instanceof BaseClass) {
                                
                                ok(true, "Instance of subclass reports that it is also an instance of the base class.");
                            } else {
                                
                                ok(false, "Instance of subclass failed to believe that it was also an instance of the base class!");
                            }
                            
                            if(foo.baseMethod && foo.baseMethod()) {
                                
                                ok(true, "Base class method was properly inherited by subclass.");
                            } else {
                                
                                ok(false, "Subclass failed to inherit a method in the base class!");
                            }
                            
                            if(foo.overwrittenMethod && foo.overwrittenMethod() == 2) {
                                
                                ok(true, "Base class method was successfully overwritten by the subclass.");
                            } else {
                                
                                ok(false, "Subclass failed to overwrite a method in the base class!");
                            }
                        } catch(e) {
                            
                            ok(false, "An exception was thrown while performing test operations: " + e);
                        }
                        
                        start();
                    }
                );
                
                test(
                    "Property inheritance",
                    function() {
                        
                        stop();
                        
                        try {
                            
                            var foo = new SubClass();
                            var bar = new ThirdClass();
                            var baz = new BaseClass();
                            
                            if(foo.baseProperty && foo.baseProperty == 'value') {
                                
                                ok(true, "Subclass successfully inherited a property from the base class.");
                            } else {
                                
                                ok(false, "Subclass failed to inherit a property from the base class!");
                            }
                            
                            if(foo.noInherit) {
                                
                                ok(true, "Class instance successfully assigned a visible property during construction.");
                            } else {
                                
                                ok(false, "Class instance failed to assign a visible property during construction!")
                            }
                            
                            if(baz.hasInherit()) {
                                
                                ok(true, "Base class can field a property assigned in the constructor.");
                            } else {
                                
                                ok(false, "Base class failed to field a property assigned in the constructor!");
                            }
                            
                            if(baz.hasInherit() && foo.hasInherit()) {
                                
                                ok(true, "Subclass can field a property assigned in the base class's constructor.");
                            } else {
                                
                                ok(false, "Subclass failed to field a property assigned in the base class's constructor!");
                            }
                            
                            if(foo.noInherit && !bar.noInherit) {
                                
                                ok(true, "Subclass correctly did not inherit a property set in the constructor of the base class.");
                            } else {
                                
                                ok(false, "Subclass incorrectly inherited a property set in the constructor of the base class!");
                            }
                            
                            if(bar.baseProperty && bar.baseProperty == 99) {
                                
                                ok(true, "Subclass successfully overwrote a property inherited from the base class.");
                            } else {
                                
                                ok(false, "Subclass failed to overwrite a property inherited from the base class!");
                            }
                            
                            if(foo.baseOptions && foo.baseOptions.first && foo.baseOptions.first == 1) {
                                
                                ok(true, "Subclass successfully integrated a value object inherited from the base class.");
                            } else {
                                
                                ok(false, "Subclass did not successfully integrate a value object inherited from the base class!");
                            }
                            
                            if(bar.baseOptions && bar.baseOptions.two && bar.baseOptions.third) {
                                
                                ok(true, "Subclass successfully integrated a value object with properties from multiple ancestors.");
                            } else {
                                
                                ok(false, "Subclass failed to integrate a value object with properties from multiple ancestors!");
                            }
                            
                        } catch(e) {
                            
                            ok(false, "An exception was thrown while performing test operations: " + e);
                        }
                        
                        start();
                    }
                );
                
                test(
                    "Super-class awareness",
                    function() {
                        stop();
                        
                        try {
                            
                            var foo = new ThirdClass();
                            
                            if(foo.overwrittenMethod() == 2) {
                                
                                ok(true, "Subclass successfully called the overwritten method on the super class.");
                            } else {
                                
                                ok(false, "Subclass failed to call the overwritten method on the super class!");
                            }
                            
                            if(foo.proxyBaseMethod()) {
                                
                                ok(true, "Subclass successfully called a method on a reference to the super class's prototype.");
                            } else {
                                
                                ok(false, "Subclass failed to call a method on a reference to the super class's prototype!");
                            }
                            
                            if(foo.proxyBaseOptions() == 1) {
                                
                                ok(true, "Subclass successfully accessed the value of an overwritten property in the superclass.");
                            } else {
                                
                                ok(false, "Subclass failed to access the value of an overwritten property in the superclass!");
                            }
                        } catch(e) {
                            
                            ok(false, "An exception was thrown while performing test operations: " + e);
                        }
                        
                        start();
                    }
                );
                
                test(
                    "Component factory pattern",
                    function() {
                        stop();
                        
                        try {
                            
                            var foo = $('#CompOne').Foo();
                            var bar = $('#CompTwo').Bar({ setting: true });
                            
                            if(foo.is('div') && bar.is('div')) {
                                
                                ok(true, "Component constructor appropriately yielded the target element as a return value.");
                            } else {
                                
                                ok(false, "Component constructor failed to yield the target element as a return value!");
                            }
                            
                            if(foo['Foo'] && foo['Bar']) {
                                
                                ok(true, "jQuery prototype has successfully spawned component construction wrappers.");
                            } else {
                                
                                ok(false, "jQuery prototype failed to spawn component construction wrappers!");
                            }
                            
                            if(foo.data('Foo') && bar.data('Bar')) {
                                
                                ok(true, "DOM elements are associated with the appropriate component data.");
                            } else {
                                
                                ok(false, "DOM elements failed to be associated with component data!");
                            }
                            
                            if(foo.Foo('baseMethod') === false) {
                                
                                ok(true, "Method called on a component yielded a return value.");
                            } else {
                                
                                ok(false, "Method called on a component failed to yield a return value!");
                            }
                            
                            if(foo.Foo('getElement').get(0) === foo.get(0)) {
                                
                                ok(true, "Component has a valid reference to the appropriate DOM element.");
                            } else {
                                
                                ok(false, "Component does not have a valid reference to the appropriate DOM element!");
                            }
                            
                            if(bar.Bar('hasSetting')) {
                                
                                ok(true, "Subcomponent successfully inherited settings initialized by the base component.");
                            } else {
                                
                                ok(false, "Subcomponent failed to inherit settings initialized by the base component!");
                            }
                            
                            bar.Bar('assignClass');
                            
                            if(bar.hasClass('fooClass') && bar.hasClass('barClass')) {
                                
                                ok(true, "Component method successfully performed polymorphic manipulation of a DOM element.");
                            } else {
                                
                                ok(false, "Component method failed to perform polymorphic manipulation of a DOM element!");
                            }
                            
                            foo.Foo('setValue', "someValue", "otherValue");
                            
                            if(foo.Foo('getValue') == "someValue.otherValue") {
                                
                                ok(true, "Component method successfully fielded multiple arguments in a method call.");
                            } else {
                                $.cf.log(foo.Foo('getValue'));
                                ok(false, "Component method failed to field multiple arguments in a method call!");
                            }
                            
                        } catch(e) {
                            
                            ok(false, "An exception was thrown while performing test operations: " + e);
                        }
                        
                        start();
                    }
                );
            });
        </script>
    </body>
</html>